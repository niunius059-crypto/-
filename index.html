<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>æ³¡é¢é“ºåå° - ç®¡ç†è®¢å•</title>
<style>
  :root{
    --bg:#0f172a;
    --panel:#1e293b;
    --panel2:#334155;
    --text:#f8fafc;
    --text-dim:#94a3b8;
    --accent:#facc15;
    --accent-bg:rgba(250,204,21,.12);
    --radius-lg:16px;
    --radius-sm:8px;
    --border:rgba(255,255,255,.08);
    --shadow:0 30px 60px rgba(0,0,0,.8);
    font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",Inter,system-ui,sans-serif;
  }
  body{
    margin:0;
    background:radial-gradient(circle at 20% 20%,rgba(250,204,21,.2) 0%,transparent 60%),radial-gradient(circle at 80% 0%,rgba(14,165,233,.25) 0%,transparent 60%),linear-gradient(160deg,#0f172a 0%,#1e293b 100%);
    color:var(--text);
    min-height:100vh;
    padding:1rem;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  header{
    width:100%;
    max-width:700px;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    box-shadow:var(--shadow);
    padding:1rem 1.2rem;
  }
  h1{
    margin:.2rem 0 .6rem;
    font-size:1.1rem;
    font-weight:600;
    color:var(--text);
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
  }
  .sub{
    font-size:.75rem;
    color:var(--text-dim);
    line-height:1.4;
  }

  .filter-row{
    margin-top:.75rem;
    display:flex;
    flex-wrap:wrap;
    gap:.5rem;
  }
  select,button{
    background:var(--panel2);
    border:1px solid var(--border);
    border-radius:var(--radius-sm);
    color:var(--text);
    font-size:.8rem;
    padding:.5rem .6rem;
    cursor:pointer;
  }
  button.accent{
    background:var(--accent-bg);
    border:1px solid var(--accent);
    color:var(--accent);
    font-weight:600;
  }

  .list{
    margin-top:1rem;
    width:100%;
    max-width:700px;
  }

  .card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    box-shadow:var(--shadow);
    padding:1rem 1.2rem;
    font-size:.8rem;
    line-height:1.5;
    margin-bottom:1rem;
    position:relative;
  }

  .row1{
    display:flex;
    flex-wrap:wrap;
    justify-content:space-between;
    gap:.5rem;
    font-size:.8rem;
    line-height:1.4;
  }
  .badge{
    background:var(--accent-bg);
    border:1px solid var(--accent);
    border-radius:var(--radius-sm);
    color:var(--accent);
    font-size:.7rem;
    font-weight:600;
    padding:.2rem .4rem;
    line-height:1.2;
  }
  .muted{
    color:var(--text-dim);
    font-size:.7rem;
  }
  .strong{
    font-weight:600;
    color:var(--text);
  }
  .pair{
    margin-top:.4rem;
  }
  .pair span{
    display:inline-block;
    min-width:4em;
    color:var(--text-dim);
  }

  .ctrl-row{
    display:flex;
    gap:.5rem;
    flex-wrap:wrap;
    margin-top:.75rem;
  }
  .ctrl-row select{
    flex:1;
  }
  .ctrl-row button{
    flex:1;
  }
</style>
</head>
<body>

<header>
  <h1>
    <span>ğŸœ æ³¡é¢é“ºåå°</span>
    <span style="font-size:.8rem;font-weight:400;color:var(--accent);">ä»…è€æ¿æŸ¥çœ‹</span>
  </h1>
  <div class="sub">
    æŸ¥çœ‹æ‰€æœ‰æœªå®Œæˆçš„è®¢å•ï¼Œæ›´æ–°æ´¾é€çŠ¶æ€ã€‚<br/>
    çŠ¶æ€å«ä¹‰ï¼šå¾…ç¡®è®¤ / å·²æ¥å— / é€é¢ä¸­ / å·²é€è¾¾ / å–æ¶ˆ
  </div>

  <div class="filter-row">
    <select id="statusFilter">
      <option value="all">å…¨éƒ¨è®¢å•</option>
      <option value="active">åªçœ‹æœªé€è¾¾</option>
      <option value="todo">åªçœ‹å¾…ç¡®è®¤</option>
    </select>
    <button class="accent" onclick="clearDelivered()">éšè—æ‰€æœ‰å·²é€è¾¾(ä¸ä¼šåˆ æ•°æ®)</button>
    <button onclick="exportData()">å¯¼å‡ºJSONå¤‡ä»½</button>
  </div>
</header>

<section class="list" id="orderList">
  <!-- è®¢å•å¡ç‰‡ä¼šç”¨JSæ’è¿›å» -->
</section>

<script>
  // è¯»æœ¬åœ°è®¢å•
  function loadOrders(){
    const raw = localStorage.getItem('noodleOrders');
    let list = [];
    if(raw){
      try{ list = JSON.parse(raw); }catch(e){ list = []; }
    }
    // æœ€æ–°çš„æ’æœ€ä¸Šé¢
    list.sort((a,b)=> (b.createdAtTs||0) - (a.createdAtTs||0));
    return list;
  }

  function saveOrders(list){
    localStorage.setItem('noodleOrders', JSON.stringify(list));
  }

  function updateStatus(orderId, newStatus){
    const list = loadOrders();
    const idx = list.findIndex(o=>o.id===orderId);
    if(idx>=0){
      list[idx].status = newStatus;
      saveOrders(list);
      render();
    }
  }

  function clearDelivered(){
    // æŠŠå·²é€è¾¾çš„æ‰“ä¸ªæ ‡è®° hidden=trueï¼Œè¿™æ ·è¿˜åœ¨æœ¬åœ°ä½†å‰ç«¯é»˜è®¤ä¸æ˜¾ç¤º
    const list = loadOrders();
    list.forEach(o=>{
      if(o.status==="å·²é€è¾¾") o.hidden = true;
    });
    saveOrders(list);
    render();
  }

  function exportData(){
    const list = loadOrders();
    const blob = new Blob([JSON.stringify(list,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const now = new Date().toISOString().slice(0,19).replace(/[:T]/g,'-');
    a.download = "noodleOrders-"+now+".json";
    a.click();
    URL.revokeObjectURL(url);
  }

  function render(){
    const wrap = document.getElementById('orderList');
    wrap.innerHTML = "";

    const filter = document.getElementById('statusFilter').value;
    const list = loadOrders();

    list.forEach(order=>{
      if(order.hidden) return;

      // è¿‡æ»¤å™¨é€»è¾‘
      if(filter==="active" && (order.status==="å·²é€è¾¾" || order.status==="å–æ¶ˆ")) return;
      if(filter==="todo" && order.status!=="å¾…ç¡®è®¤") return;

      const card = document.createElement('div');
      card.className = "card";

      const row1 = document.createElement('div');
      row1.className = "row1";

      const leftInfo = document.createElement('div');
      leftInfo.innerHTML = `
        <div class="strong">${order.noodle} <span style="color:#facc15;">Â¥${order.price}</span></div>
        <div class="muted">è®¢å•IDï¼š${order.id}</div>
        <div class="muted">ä¸‹å•æ—¶é—´ï¼š${order.createdAt || ''}</div>
      `;

      const rightInfo = document.createElement('div');
      rightInfo.innerHTML = `<div class="badge">${order.status}</div>`;

      row1.appendChild(leftInfo);
      row1.appendChild(rightInfo);

      const detail = document.createElement('div');
      detail.innerHTML = `
        <div class="pair"><span>å®¿èˆ</span>${order.building} ${order.room}</div>
        <div class="pair"><span>å¤‡æ³¨</span>${order.note || "ï¼ˆæ— ï¼‰"}</div>
        <div class="pair"><span>æ—¶é—´</span>${order.timeSlot}</div>
        <div class="pair"><span>è”ç³»</span>${order.contact}</div>
      `;

      const ctrl = document.createElement('div');
      ctrl.className = "ctrl-row";

      const sel = document.createElement('select');
      ["å¾…ç¡®è®¤","å·²æ¥å—","é€é¢ä¸­","å·²é€è¾¾","å–æ¶ˆ"].forEach(s=>{
        const op = document.createElement('option');
        op.value = s;
        op.textContent = s;
        if(order.status===s) op.selected = true;
        sel.appendChild(op);
      });

      const btn = document.createElement('button');
      btn.textContent = "æ›´æ–°çŠ¶æ€";
      btn.onclick = ()=>{
        updateStatus(order.id, sel.value);
      };

      ctrl.appendChild(sel);
      ctrl.appendChild(btn);

      card.appendChild(row1);
      card.appendChild(detail);
      card.appendChild(ctrl);

      wrap.appendChild(card);
    });
  }

  // é¦–æ¬¡åˆå§‹åŒ–ï¼šå¦‚æœè€è®¢å•é‡Œæ²¡æœ‰æ—¶é—´æˆ³ï¼ŒåŠ ä¸Šæ—¶é—´æˆ³
  (function normalize(){
    const list = loadOrders();
    let changed = false;
    list.forEach(o=>{
      if(!o.createdAtTs){
        o.createdAtTs = Date.now();
        changed = true;
      }
    });
    if(changed){
      saveOrders(list);
    }
  })();

  // ç›‘å¬ç­›é€‰å™¨
  document.getElementById('statusFilter').addEventListener('change', render);

  // æ¸²æŸ“é¡µé¢
  render();
</script>
</body>
</html>
